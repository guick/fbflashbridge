<?xml version="1.0" encoding="utf-8"?>
<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml" layout="vertical" applicationComplete="init();" backgroundColor="0xFFFFFF" backgroundImage="">
	<mx:Script>
		<![CDATA[
		
			import com.facebook.Facebook;
			import com.facebook.events.FacebookEvent;
			import com.facebook.net.FacebookCall;
			import com.facebook.data.users.FacebookUser;
			import com.facebook.data.users.GetInfoData;
			import com.facebook.commands.users.GetInfo;
			import com.facebook.utils.FacebookSessionUtil;
		
			private var fbook:Facebook;
			private var session:FacebookSessionUtil;
			
			private var API_KEY:String = "ab00ea694dbb0fcf4f1b23131678cd4a";
			private var SECRET_KEY:String = "685e717cf1468d6e9c68a4a98085a1eb";
			
			private function init():void {
				session=new FacebookSessionUtil(API_KEY, SECRET_KEY, loaderInfo);
				session.addEventListener(FacebookEvent.CONNECT, onConnect);
				fbook=session.facebook;
			}
			
			private function onConnect(e:FacebookEvent):void {
				status.text = "Facebook API Ready";	
			}
			
			private function doneLoggingIn():void {
				session.validateLogin();
			}
		
			private function sayHello():void {
				var call:FacebookCall = fbook.post(new GetInfo([fbook.uid], ['first_name', 'last_name']));
				call.addEventListener(FacebookEvent.COMPLETE, handleGetInfoResponse);
			}
		
			private function handleGetInfoResponse(e:FacebookEvent):void {
				var responseData:GetInfoData = e.data as GetInfoData;
				
				if (!responseData || e.error){ // an error occurred
					status.text = "Error";
					return;
				}
				
				var firstName:String = responseData.userCollection.getItemAt(0).first_name;
				var lastName:String = responseData.userCollection.getItemAt(0).last_name;
				
				output.text = "Hello " + firstName + " " + lastName;
			}
			
		]]>
	</mx:Script>
	
	<mx:Button label="1. Login to Facebook" click="session.login();" />
	<mx:Button label="2. Done logging in" click="doneLoggingIn()" />
	<mx:Button label="3. Say Hello" click="sayHello()" />
	
	<mx:Label id="status" text="Please log in" />
	<mx:Label id="output" text="Hello" />

</mx:Application>
